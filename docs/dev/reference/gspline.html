<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>General parametric regression splines with variable degrees and smoothness — gspline • spida2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="General parametric regression splines with variable degrees and smoothness — gspline"><meta name="description" content="This function creates functions (closures) that implement general polynomial splines
with possibly different degrees
in each interval and different orders of smoothness at each knot,
including the possibility of allowing a discontinuity at a knot.
For transitional reasons with the forthcoming
gspline package, Gspline is a synonym for
gspline."><meta property="og:description" content="This function creates functions (closures) that implement general polynomial splines
with possibly different degrees
in each interval and different orders of smoothness at each knot,
including the possibility of allowing a discontinuity at a knot.
For transitional reasons with the forthcoming
gspline package, Gspline is a synonym for
gspline."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spida2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/spida2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/generalParametricSplines_v2.html">General Parametric Splines in carEx v.2</a></li>
    <li><a class="dropdown-item" href="../articles/generalParametricSplines.html">General Parametric Splines in carEx</a></li>
    <li><a class="dropdown-item" href="../articles/pdInd.html">pdInd</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmonette/spida2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>General parametric regression splines with variable degrees and smoothness</h1>
      <small class="dont-index">Source: <a href="https://github.com/gmonette/spida2/blob/HEAD/R/gspline.R" class="external-link"><code>R/gspline.R</code></a></small>
      <div class="d-none name"><code>gspline.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function creates functions (closures) that implement general polynomial splines
with possibly different degrees
in each interval and different orders of smoothness at each knot,
including the possibility of allowing a discontinuity at a knot.</p>
<p>For transitional reasons with the forthcoming
gspline package, <code>Gspline</code> is a synonym for
<code>gspline</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gspline</span><span class="op">(</span></span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">degree</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">degree</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  constraints <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  estimates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  periodic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">1e-14</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gspline'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  show <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"knots"</span>, <span class="st">"degree"</span>, <span class="st">"smoothness"</span>, <span class="st">"G"</span>, <span class="st">"constraint_mat"</span>, <span class="st">"estimate_mat"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gspline_matrix'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knots_.gspline</span><span class="op">(</span><span class="va">sp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">Gspline</span><span class="op">(</span></span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">degree</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">degree</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  constraints <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  estimates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  periodic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">1e-14</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-knots">knots<a class="anchor" aria-label="anchor" href="#arg-knots"></a></dt>
<dd><p>vector of knots</p></dd>


<dt id="arg-degree">degree<a class="anchor" aria-label="anchor" href="#arg-degree"></a></dt>
<dd><p>vector giving the degree of the spline in each interval. Note
the number of intervals is equal to the number of knots + 1. A value of 0
corresponds to a constant in the interval.</p></dd>


<dt id="arg-smoothness">smoothness<a class="anchor" aria-label="anchor" href="#arg-smoothness"></a></dt>
<dd><p>vector with the degree of smoothness at each knot (0 =
continuity, 1 = smooth with continuous first derivative, 2 = continuous
second derivative, etc. The value -1 allows a discontinuity at the knot.
Alternative, a list each of whose elements specifies the derivatives
that must be continuous at each knot. This allow the set of continuous
derivatives to skip a value. For example, to specify that a function
can have a discontinuity but must have the same limiting slope and second
derivative (curvature) on either side
of the discontinuity, the smoothness vector for the corresponding knot would have the
value <code>c(1,2)</code>, thus leaving the value (denoted by 0) unconstrained.</p></dd>


<dt id="arg-constraints">constraints<a class="anchor" aria-label="anchor" href="#arg-constraints"></a></dt>
<dd><p>provides a vector or matrix specifying additional linear contraints on the
'full' parametrization consisting of blocks of polynomials of degree equal
to max(degree) in each of the length(knots)+1 intervals of the spline. See
below for examples of a spline that is 0 outside of its boundary knots.</p></dd>


<dt id="arg-estimates">estimates<a class="anchor" aria-label="anchor" href="#arg-estimates"></a></dt>
<dd><p>provides a vector or matrix specifying additional linear combination of
the parameters in the
'full' parametrization that should be estimated by estimated coefficients of the spline.</p></dd>


<dt id="arg-periodic">periodic<a class="anchor" aria-label="anchor" href="#arg-periodic"></a></dt>
<dd><p>if TRUE a periodic spline is generated on the base interval
0,max(knots). A constraint is generated so that the coefficients generate, in effect,
the same fitted values and derivatives to the right of max(knots) as they do to the right of 0.
Note that all knots must be strictly positive. Since the knot at 0 corresponds to the
knot at 'max(knots)', the knot at 0 must not be explicitly specified. Note also that the
degree in the interval to the right of 'max(knots)' must be equal to that in the
interval to the left of 'min(knots)'. If these are specified to be equal,
<code>gspline</code> uses the maximum for both intervalsl.
The continuity contraints associated
with the last knot are, in effect, continuity constraints at 0.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>(parameter of the closure created by <code>gspline</code>) value(s) where the
spline is evaluated. This is the only parameter used when generating portions of
a model matrix.</p></dd>


<dt id="arg-signif">signif<a class="anchor" aria-label="anchor" href="#arg-signif"></a></dt>
<dd><p>number of significant digits used to label coefficients</p></dd>


<dt id="arg-exclude">exclude<a class="anchor" aria-label="anchor" href="#arg-exclude"></a></dt>
<dd><p>(not yet implemented) number of leading columns to drop from spline matrix: 0:
excludes the intercept column, 1: excludes the linear term as well.  Terms
that are excluded from the spline matrix can be modeled explicitly.</p></dd>


<dt id="arg-a">a<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>(not yet implemented) a 'periodic' knot at which a spline repeats itself</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>(not yet implemented) the maximal 'order', i.e. maximal degree + 1, of a periodic spline</p></dd>


<dt id="arg-d">D<a class="anchor" aria-label="anchor" href="#arg-d"></a></dt>
<dd><p>(parameter of the closure created by <code>gspline</code>) value(s) the order of
derivatives to be estimated when creating a linear hypothesis matrix. The default
is <code>D=0</code> corresponding to the value of the spline.</p></dd>


<dt id="arg-limit">limit<a class="anchor" aria-label="anchor" href="#arg-limit"></a></dt>
<dd><p>(parameter of the closure created by <code>gspline</code>) specifies
whether a derivative or value should be estimated as as limit from the left
<code>limit = -1</code>, from the right, <code>limit = -1</code>, or the difference of the
two limits, <code>limit = -0</code>. The default is <code>limit = -1</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>gspline</code> returns a closure that creates portions of model matrices
or of linear hypothesis matrices for Wald test for a general polynomial spline.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The functions created by <code>gspline</code> can also be used to generate portions
of a linear hypothesis matrix that can be used with a Wald test
to estimate features of the spline such as derivatives of various orders,
discontinuities, etc.</p>
<p>Many polynomial regression splines can be generated by 'plus' functions
although the resulting basis for the spline may be ill conditioned. For
example, a 'quadratic spline' (a spline that is quadratic in each interval
with and smooth with a first derivative at each knot) with knots at 1 and 3
can be fitted with:</p>
<p><code>   plus &lt;- function(x,y) ifelse(x&gt;0,y,0)</code><br><code>   lm(y ~ x + I(x^2) + plus(x-1,(x-1)^2) + plus(x-3,(x-3)^2))</code></p>
<p>All 'standard' polynomial splines with the same
degree in each interval and continuity of
order one less than the degree at each knot can be constructed in this
fashion. A convenient aspect of this parametrization of the spline is that
the estimated coefficients have a simple interpretation. The coefficients
for 'plus' terms represent the 'saltus' (jump) in the value of a coefficient
at the knot. Testing whether the true value of the saltus in a coefficient is 0 is
equivalent to a test for the need to retain the corresponding knot.</p>
<p>This approach does not work for some more complex splines with different
degrees or different orders of continuity at the knots.</p>
<p>Many techniques for fitting splines generate a basis for the spline
(columns of the design matrix) that has good numerical properties but
whose coefficients do not have a simple interpretation.</p>
<p>The <code>gspline</code> function generates functions representing splines
with arbitrary degrees in each interval and
arbitrary smoothness at each knot. Any set of orders of derivatives can
be contrained to be continuous at any particular knot.
The parametrization produces coefficients
that have a simple interpretation. For a spline of degree p at x = 0,
coefficients correspond to the 1st, 2nd, ... pth derivative at 0. Additional
coefficients correspond to each free discontinuities at each knot.</p>
<p>A disadvantage of spline functions generated by <code>gspline</code>
is that the spline basis may
be poorly conditioned.  The impact of this problem can be mitigated by
rescaling the x variable so that it has an appropriate range. For example,
with a spline whose highest degree is cubic, ensuring that x has a range
between -10 and 10 should avert numerical problems.</p>
<p>Let <code>sp</code> denote a spline matrix created by <code>gspline</code>. For example
<code>sp &lt;- gspline(knots = c(-1,0,2), degree = c(2,3,3,2), smoothness = c(1,-1,1))</code>
creates a spline function <code>sp</code> that can be used in linear formulas to
fit a polynomial spline with knots at -1, 0 and 2, with degrees 2, 3, 3, and 2 in
the four intervals bounded by the knots and with "C 1" continuity (continuous
first derivative) at the knots -1 and 2, and a possible discontinuity in value
at the knot 0.</p>
<p>The linear formula to fit this spline has the form <code>y ~ 1 + sp(x)</code> which can
be augmented with other regressors in the usual way.</p>
<p>Called with a single argument (e.g. <code>sp(x)</code>) <code>sp</code>
returns a matrix of regressors and can be used in linear model formulas,
e.g <code>y ~ sp(x)</code>, <code>y ~ A * sp(x)</code> or <code>y ~ A / sp(x) -1</code>
if <code>A</code> is a factor to fit separate splines
within each level of <code>A</code>.</p>
<p><code>sp</code> can be called with additional
argument to geneate portions of linear hypothesis matrices that
can be used test or estimate various values or derivatives of the spline. For
example, <code>sp(c(-1,-1,-1,0,2), D = c(2, 2, 2, 0, 1), limit = c(-1, 1, 0, 0, 1))</code>
will return a matrix of coefficients to estimate, respectively, the limits from the
left and from the right of the second derivative at -1, the difference (jump or saltus)
in this derivative at -1, the size of the discontinuity in the value of the function
at 0, and the first derivative at 1, which being continuous there has the same value
whether a limit is taken from the right or from the left.</p>
<p>A function to fit a cubic spline with knots at 5 and 10 is generated with
<code>sp &lt;- gspline(knots = c(5, 10), degree = c(3, 3, 3), smoothness = c(2, 2))</code>, or more
briefly: <code>sp &lt;- gspline(c(5, 10), 3, 2)</code> since the degree and smoothness arguments
are recycled as required by the number of knots.</p>
<p>A natural cubic spline with knots at 5 and 10 and boundary knots at 0 and 20 can be
created with
<code>sp &lt;- gspline(c(0, 5, 10, 20), c(1, 3, 3, 3, 1), c(2, 2, 2, 2))</code>.</p>
<p>A step function with steps at 0, 1 and 2 would have the form:
<code>sp &lt;- gspline(c(0, 1, 2), 0, -1)</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="warning">Warning<a class="anchor" aria-label="anchor" href="#warning"></a></h2>
    <p>The estimands generated by spline functions created
by <code>gspline</code> are designed so the
coefficients are interpretable as changes in derivatives at knots. The
resulting matrix is not designed to have optimal numerical properties.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>

    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Georges Monette.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>


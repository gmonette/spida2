<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>General regression splines with variable degrees and ness, smoothing splines — gsp • spida2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="General regression splines with variable degrees and ness, smoothing splines — gsp"><meta name="description" content="These functions implement a general polynomial spline with possibly different degrees
in each interval and different orders of smoothness at each knot,
including the possibility of allowing a discontinuity at a knot. The
function sc helps in the construction of linear hypothesis matrices
to estimate and test levels and derivatives of splines at arbitrary points
and the saltus of derivatives that have discontinuities at knots."><meta property="og:description" content="These functions implement a general polynomial spline with possibly different degrees
in each interval and different orders of smoothness at each knot,
including the possibility of allowing a discontinuity at a knot. The
function sc helps in the construction of linear hypothesis matrices
to estimate and test levels and derivatives of splines at arbitrary points
and the saltus of derivatives that have discontinuities at knots."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spida2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/spida2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/generalParametricSplines_v2.html">General Parametric Splines in carEx v.2</a></li>
    <li><a class="dropdown-item" href="../articles/generalParametricSplines.html">General Parametric Splines in carEx</a></li>
    <li><a class="dropdown-item" href="../articles/pdInd.html">pdInd</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmonette/spida2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>General regression splines with variable degrees and ness, smoothing splines</h1>
      <small class="dont-index">Source: <a href="https://github.com/gmonette/spida2/blob/HEAD/R/gsp.R" class="external-link"><code>R/gsp.R</code></a></small>
      <div class="d-none name"><code>gsp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions implement a general polynomial spline with possibly different degrees
in each interval and different orders of smoothness at each knot,
including the possibility of allowing a discontinuity at a knot. The
function <code><a href="sc.html">sc</a></code> helps in the construction of linear hypothesis matrices
to estimate and test levels and derivatives of splines at arbitrary points
and the saltus of derivatives that have discontinuities at knots.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gsp</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">degree</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">degree</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  lin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  periodic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  signif <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>value(s) where spline is evaluated</p></dd>


<dt id="arg-knots">knots<a class="anchor" aria-label="anchor" href="#arg-knots"></a></dt>
<dd><p>vector of knots</p></dd>


<dt id="arg-degree">degree<a class="anchor" aria-label="anchor" href="#arg-degree"></a></dt>
<dd><p>vector giving the degree of the spline in each interval. Note
the number of intervals is equal to the number of knots + 1. A value of 0
corresponds to a constant in the interval. If the spline should evaluate to
0 in the interval, use the <code>intercept</code> argument to specify some value
in the interval at which the spline must evaluate to 0.</p></dd>


<dt id="arg-smoothness">smoothness<a class="anchor" aria-label="anchor" href="#arg-smoothness"></a></dt>
<dd><p>vector with the degree of smoothness at each knot (0 =
continuity, 1 = smoothness with continuous first derivative, 2 = continuous
second derivative, etc. The value -1 allows a discontinuity at the knot.
A scalar is recycled so its length equals the
number of knots. Alternatively,
a list of length equal to the number of knots. Each element of the list is a
vector of the orders of derivatives which are required to be smooth. THis allows
non-sequential constraints, e.g. to have the same first and second derivative
on either side of a knot but a possible discontinuity and change in
higher-order derivatives, the vector would be c(1,2). Note that if a list is used,
all elements must provide all desired constraints. That is the list argument corresponding
to <code>smoothness = c(1,2,-1)</code> is <code>smoothness=list(0:1, 0:2, -1)</code>. The default is
1 less than the minimum of adjoining degrees at</p></dd>


<dt id="arg-lin">lin<a class="anchor" aria-label="anchor" href="#arg-lin"></a></dt>
<dd><p>provides a matrix specifying additional linear contraints on the
'full' parametrization consisting of blocks of polynomials of degree equal
to max(degree) in each of the length(knots)+1 intervals of the spline. See
below for examples of a spline that is 0 outside of its boundary knots.</p></dd>


<dt id="arg-periodic">periodic<a class="anchor" aria-label="anchor" href="#arg-periodic"></a></dt>
<dd><p>if TRUE generates a period spline on the base interval
0,max(knots). A constraint is generated so that the coefficients generate
the same values to the right of max(knots) as they do to the right of 0.
Note that all knots should be strictly positive.</p></dd>


<dt id="arg-intercept">intercept<a class="anchor" aria-label="anchor" href="#arg-intercept"></a></dt>
<dd><p>value(s) of x at which the spline has value 0, i.e. the
value(s) of x for which yhat is estimated by the intercept term in the
model. The default is 0. If NULL, the spline is not constrained to evaluate
to 0 for any x.</p></dd>


<dt id="arg-signif">signif<a class="anchor" aria-label="anchor" href="#arg-signif"></a></dt>
<dd><p>number of significant digits used to label coefficients</p></dd>


<dt id="arg-exclude">exclude<a class="anchor" aria-label="anchor" href="#arg-exclude"></a></dt>
<dd><p>number of leading columns to drop from spline matrix: 0:
excludes the intercept column, 1: excludes the linear term as well.  Terms
that are excluded from the spline matrix can be modeled explicitly.</p></dd>


<dt id="arg-a">a<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>a 'periodic' knot at which a spline repeats itself</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>the maximal 'order', i.e. maximal degree + 1, of a periodic spline</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>gsp</code> returns a matrix generating a spline. <code>cs</code>,
<code>qs</code> and <code>lsp</code> return matrices generating cubic, quadratic and
linear splines respectively.</p>
<p><code>smsp</code>, whose code is adapted from function in the package
<code>lmeSplines</code>, generates a smoothing spline to be used in the random
effects portion of a call to <code>lme</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Many polynomial regression splines can be generated by 'plus' functions
although the resulting basis for the spline may be ill conditioned. For
example, a 'quadratic spline' (a spline that is quadratic in each interval
with and smooth with a first derivative at each knot) with knots at 1 and 3
can be fitted with:</p>
<p><code>   plus &lt;- function(x,y) ifelse(x&gt;0,y,0)</code><br><code>   lm(y ~ x + I(x^2) + plus(x-1,(x-1)^2) + plus(x-3,(x-3)^2))</code></p>
<p>All 'standard' polynomial splines with the same
degree in each interval and continuity of
order one less than the degree at each knot can be constructed in this
fashion. A convenient aspect of this parametrization of the spline is that
the estimated coefficients have a simple interpretation. The coefficients
for 'plus' terms represent the 'saltus' (jump) in the value of a coefficient
at the knot. Testing whether the true value of the saltus in a coefficient is 0 is
equivalent to a test for the need to retain the corresponding knot.</p>
<p>This approach does not work for some more complex splines with different
degrees or different orders of continuity at the knots. An example is the
commonly used natural quadratic spline. A natural quadratic spline with
knots at -1,0 and 1 (where -1 and 1 are termed 'boundary knots') is linear
in the intervals (-Inf,-1) and (1,+Inf), and quadratic in the intervals
(-1,0) and (0,1). The spline is smooth of order 1 at each knot.</p>
<p>Many
techniques for fitting splines generate a basis for the spline (columns of
the design matrix) that has good numerical properties but whose coefficients
do not have a simple interpretation.</p>
<p>The <code>gsp</code> function makes it
easy to specify a spline with arbitrary degree in each interval and
arbitrary smoothness at each knot. The parametrization produces coefficients
that have a simple interpretation. For a spline of degree p at x = 0,
coefficients correspond to the 1st, 2nd, ... pth derivative at 0. Additional
coefficients correspond to each free saltus at each knot.</p>
<p>The
<code>sc</code> function generates a matrix to estimate features of a fitted
spline that can be expressed as linear combinations of the spline
coefficients.  Examples are various derivatives of the spline at any point,
left or right derivatives of different orders and the saltus in derivatives
at a knot.</p>
<p>A disadvantage of <code>gsp</code> is that the spline basis may
be poorly conditioned.  The impact of this problem can be mitigated by
rescaling the x variable so that it has an appropriate range. For example,
with a spline whose highest degree is cubic, ensuring that x has a range
between -10 and 10 should avert numerical problems.</p>
<p><code>gsp</code>
generates a matrix of regressors for a spline with knots, degree of
polynomials in each interval and the degree of smoothness at each knot.
Typically, <code>gsp</code> is used to define a function that is then used in a
model equation. See the examples below.</p>
<p>A function to fit a cubic spline with knots at 5 and 10 is generated with:</p>
<p>Overview of utility functions:</p>
<p><code>Xmat = function( x, degree, D = 0, signif = 3)</code> design/estimation matrix for f<a href="x">D</a> where f(x) is
polynomial of degree degree.</p>
<p><code>Xf = function( x, knots, degree = 3, D = 0, right = TRUE , signif = 3)</code>
uses
Xmat to form 'full' matrix with blocks determined by knots intervals</p>
<p><code>Cmat = function( knots, degree, smoothness, intercept = 0, signif = 3)</code>
linear constraints</p>
<p><code>Emat = function( knots, degree, smoothness , intercept = FALSE, signif = 3)</code>
estimates - not necessarily a basis</p>
<p><code>basis = function( X , coef = FALSE )</code> selects linear independent subset of
columns of X</p>
<p><code>spline.T = function( knots, degree, smoothness, intercept = 0, signif = 3 )</code>
full transformation of Xf to spline basis and constraints</p>
<p><code>spline.E = function( knots, degree, smoothness, intercept = 0, signif = 3 )</code>
transformation for spline basis (first r columns of spline.T)</p>
    </div>
    <div class="section level2">
    <h2 id="warning">Warning<a class="anchor" aria-label="anchor" href="#warning"></a></h2>
    <p>The variables generated by <code>gsp</code> are designed so the
coefficients are interpretable as changes in derivatives at knots. The
resulting matrix is not designed to have optimal numerical properties.</p>
<p>The intermediate matrices generated by <code>gsp</code> will contain <code>x</code>
raised to the power equal to the highest degree in <code>degree</code>. The values
of <code>x</code> should be scaled to avoid excessively large values in the spline
matrix and ensuing numerical problems.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>%% ~put references to the literature/web site here ~</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="wald.html">wald</a></code> <code><a href="sc.html">sc</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Monette, G. <a href="mailto:georges@yorku.ca">georges@yorku.ca</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Fitting a quadratic spline</span></span></span>
<span class="r-in"><span><span class="va">simd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>,<span class="st">'female'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># define a function generating the spline</span></span></span>
<span class="r-in"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">25</span>,<span class="fl">40</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html" class="external-link">sp</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">*</span><span class="va">G</span>, <span class="va">simd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> , <span class="va">simd</span>, groups <span class="op">=</span> <span class="va">G</span>,type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gsp-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ sp(age) * G, data = simd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.2942 -0.7659 -0.0492  0.9141  2.7562 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           0.086392   0.617165   0.140    0.889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)D1(0)         -0.017379   0.056264  -0.309    0.758</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(10).2        0.004676   0.007048   0.663    0.509</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(25).2       -0.011788   0.013138  -0.897    0.372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gmale                 0.029988   0.872803   0.034    0.973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)D1(0):Gmale    0.014235   0.079569   0.179    0.858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(10).2:Gmale -0.003436   0.009968  -0.345    0.731</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(25).2:Gmale  0.011740   0.018579   0.632    0.529</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 1.249 on 92 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.04345,	Adjusted R-squared:  -0.02933 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 0.597 on 7 and 92 DF,  p-value: 0.7568</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Linear hypotheses</span></span></span>
<span class="r-in"><span><span class="va">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">"Overall test of slopes at 20"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"Female slope at age 20"</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">F20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fl">0</span> , <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span> <span class="va">sp</span>, <span class="fl">20</span>, D <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span> , <span class="fl">0</span> <span class="op">*</span> <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span> <span class="va">sp</span>, <span class="fl">20</span>, D <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="st">"Male slope at age 20"</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">M20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fl">0</span> , <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span> <span class="va">sp</span>, <span class="fl">20</span>, D <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span> , <span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span> <span class="va">sp</span>, <span class="fl">20</span>, D <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="st">"Difference"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">M20</span> <span class="op">-</span> <span class="va">F20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span> <span class="va">fit</span>, <span class="va">L</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                              numDF denDF   F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall test of slopes at 20     2    92 0.5766615 0.56379</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        Estimate  Std.Error DF t-value   p-value Lower 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Female slope at age 20  0.029378 0.02868   92  1.024347 0.30836 -0.027583 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Male slope at age 20    0.009251 0.02868   92  0.322546 0.74777 -0.047710 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Difference             -0.020128 0.04056   92 -0.496248 0.62090 -0.100683 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Female slope at age 20 0.086339  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Male slope at age 20   0.066212  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Difference             0.060427  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Right and left second derivatives at knots and saltus</span></span></span>
<span class="r-in"><span><span class="va">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">"Second derivatives and saltus for female curve at knot at 25"</span> <span class="op">=</span></span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fl">0</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span> <span class="va">sp</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">25</span>,<span class="fl">25</span><span class="op">)</span>, D <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">L</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`Second derivatives and saltus for female curve at knot at 25`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           D1(0)       C(10).2       C(25).2        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D2(25-)         0 -5.921189e-18  1.000000e+00 -2.652693e-15 0 0 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D2(25+)         0  0.000000e+00  1.000000e+00  1.000000e+00 0 0 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D2(25+)-D2(25-) 0  5.921189e-18 -1.998401e-15  1.000000e+00 0 0 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span> <span class="va">fit</span>, <span class="va">L</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                              numDF denDF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Second derivatives and saltus for female curve at knot at 25     2    92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Second derivatives and saltus for female curve at knot at 25 0.6013702  0.5502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Estimate  Std.Error DF t-value   p-value Lower 0.95 Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D2(25-)          0.004676 0.007048  92  0.663374 0.50875 -0.009323  0.018674  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D2(25+)         -0.007112 0.006769  92 -1.050610 0.29619 -0.020557  0.006333  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D2(25+)-D2(25-) -0.011788 0.013138  92 -0.897246 0.37193 -0.037880  0.014305  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Quadratic natural spline</span></span></span>
<span class="r-in"><span><span class="va">simd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">2</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                    G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>,<span class="st">"female"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">25</span>,<span class="fl">40</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>          degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>          smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html" class="external-link">sp</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">*</span><span class="va">G</span>, <span class="va">simd</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> , <span class="va">simd</span>, groups <span class="op">=</span> <span class="va">G</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="gsp-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># convenient display</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ sp(age) * G, data = simd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.0231 -0.7345 -0.1092  0.8553  2.8964 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           0.623413   0.575750   1.083    0.282</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)D1(0)         -0.046430   0.052488  -0.885    0.379</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(10).2        0.003824   0.006575   0.582    0.562</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(25).2       -0.003731   0.012256  -0.304    0.761</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gmale                -1.205383   0.814233  -1.480    0.142</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)D1(0):Gmale    0.077315   0.074230   1.042    0.300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(10).2:Gmale -0.004678   0.009299  -0.503    0.616</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(25).2:Gmale  0.002693   0.017333   0.155    0.877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 1.165 on 92 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.03356,	Adjusted R-squared:  -0.03998 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 0.4564 on 7 and 92 DF,  p-value: 0.8635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># output:</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Call:</span></span></span>
<span class="r-in"><span><span class="co"># lm(formula = y ~ sp(age) * G, data = simd)</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># Residuals:</span></span></span>
<span class="r-in"><span><span class="co">#     Min      1Q  Median      3Q     Max </span></span></span>
<span class="r-in"><span><span class="co"># -3.1111 -0.9429  0.0774  0.6633  3.6171 </span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># Coefficients:</span></span></span>
<span class="r-in"><span><span class="co">#   Estimate Std. Error t value Pr(&gt;|t|)</span></span></span>
<span class="r-in"><span><span class="co"># (Intercept)           0.522681   0.623071   0.839    0.404</span></span></span>
<span class="r-in"><span><span class="co"># sp(age)D1(0)         -0.060361   0.056802  -1.063    0.291</span></span></span>
<span class="r-in"><span><span class="co"># sp(age)C(10).2        0.009013   0.007116   1.267    0.208</span></span></span>
<span class="r-in"><span><span class="co"># sp(age)C(25).2       -0.015459   0.013263  -1.166    0.247</span></span></span>
<span class="r-in"><span><span class="co"># Gmale                -0.092681   0.881156  -0.105    0.916</span></span></span>
<span class="r-in"><span><span class="co"># sp(age)D1(0):Gmale    0.042878   0.080331   0.534    0.595</span></span></span>
<span class="r-in"><span><span class="co"># sp(age)C(10).2:Gmale -0.006703   0.010063  -0.666    0.507</span></span></span>
<span class="r-in"><span><span class="co"># sp(age)C(25).2:Gmale  0.007650   0.018757   0.408    0.684</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Residual standard error: 1.261 on 92 degrees of freedom</span></span></span>
<span class="r-in"><span><span class="co"># Multiple R-squared:  0.05212,  Adjusted R-squared:  -0.02 </span></span></span>
<span class="r-in"><span><span class="co"># F-statistic: 0.7227 on 7 and 92 DF,  p-value: 0.653</span></span></span>
<span class="r-in"><span><span class="co"># ---</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">L0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>    <span class="st">"hat"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>         <span class="st">"females at age=20"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span> <span class="op">*</span> <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>         <span class="st">"males at age=20"</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">*</span> <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"male-female"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>         <span class="st">"at 20"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">0</span> , <span class="fl">0</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">L0</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     numDF denDF    F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hat     2    92 0.06773049 0.93456</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Estimate  Std.Error DF t-value   p-value Lower 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> females at age=20 -0.113961 0.310209  92 -0.367369 0.71419 -0.730064 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> males at age=20   -0.006941 0.310209  92 -0.022376 0.98220 -0.623044 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> females at age=20 0.502141  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> males at age=20   0.609161  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             numDF denDF    F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> male-female     1    92 0.05951007 0.80782</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Estimate Std.Error DF t-value  p-value Lower 0.95 Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> at 20 0.10702  0.438702  92 0.243947 0.80782 -0.764281  0.978321  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">L1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"D(yhat)/D(age)"</span> <span class="op">=</span> </span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="st">"female at age = 25"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    <span class="st">"male at x = 25"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span> <span class="va">fit</span>, <span class="va">L1</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                numDF denDF    F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D(yhat)/D(age)     2    92 0.07597554  0.9269</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Estimate Std.Error DF t-value  p-value Lower 0.95 Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> female at age = 25 0.010935 0.054212  92 0.201713 0.84059 -0.096734  0.118605  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> male at x = 25     0.018083 0.054212  92 0.333561 0.73947 -0.089587  0.125753  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A periodic spline function can be generated by forcing the coefficients</span></span></span>
<span class="r-in"><span><span class="co"># beyond a periodic knot to repeat the pattern in a previous inteval. For</span></span></span>
<span class="r-in"><span><span class="co"># example a periodic spline of period 1 can be created as follows:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">.01</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">per.sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span>, knots <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>                  degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                  smoothness <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                  lin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/spida2/man/PolyShift.html" class="external-link">PolyShift</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">per.sp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>number of items to replace is not a multiple of replacement length</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ per.sp(x))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -2.7754 -0.6504  0.0053  0.6529  3.2558 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  0.20097    0.07694   2.612  0.00922 **</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)   -1.51985    0.78902  -1.926  0.05455 . </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.984 on 599 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.006156,	Adjusted R-squared:  0.004497 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic:  3.71 on 1 and 599 DF,  p-value: 0.05455</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , </span></span>
<span class="r-in"><span>     panel <span class="op">=</span> <span class="va">panel.superpose.2</span>,</span></span>
<span class="r-in"><span>     type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>,<span class="st">"l"</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="gsp-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gsp-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#' # A periodic spline with additional knots can be created as shown below. Note</span></span></span>
<span class="r-in"><span><span class="co"># that constraint matrix 'lin' expresses constraints for the 'full' polynomial</span></span></span>
<span class="r-in"><span><span class="co"># parametrization, i.e. polynomials of degree 3 (thus of order 4 when</span></span></span>
<span class="r-in"><span><span class="co"># including the constant term) in each of the 4 intervals.  The constraint</span></span></span>
<span class="r-in"><span><span class="co"># given in 'lin' forces the coefficients beyond the periodic knot at x = 1, to</span></span></span>
<span class="r-in"><span><span class="co"># repeat the polynomial in the interval just to the right of x = 0.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">.01</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">per.sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.333</span>,<span class="fl">.666</span>,<span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>            degree <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>            smoothness <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>            lin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/spida2/man/PolyShift.html" class="external-link">PolyShift</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">per.sp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>number of items to replace is not a multiple of replacement length</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ per.sp(x))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.2739 -0.6484  0.0253  0.7026  3.2238 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate Std. Error t value Pr(&gt;|t|)   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          -0.4105     0.1487  -2.761  0.00594 **</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)D1(0)        1.8954     1.9483   0.973  0.33104   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)D2(0)        1.3131    12.6685   0.104  0.91748   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)D3(0)      -41.7090    40.1662  -1.038  0.29950   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)C(0.333).2  -7.2524    35.9149  -0.202  0.84004   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)C(0.333).3 202.6557   182.4831   1.111  0.26721   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9861 on 595 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.01534,	Adjusted R-squared:  0.007066 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 1.854 on 5 and 595 DF,  p-value: 0.1006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , </span></span>
<span class="r-in"><span>   panel <span class="op">=</span> <span class="va">panel.superpose.2</span>,</span></span>
<span class="r-in"><span>   type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>,<span class="st">"l"</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="gsp-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gsp-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Cubic spline:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The parameters indicate that a cubic polynomial is used in each of the three intervals</span></span></span>
<span class="r-in"><span><span class="co"># and that the second derivative is continuous at each knot.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Natural cubic spline:</span></span></span>
<span class="r-in"><span><span class="co"># is a cubic spline in bounded intervals with linear components </span></span></span>
<span class="r-in"><span><span class="co"># in each unbounded interval and continuous first derivative at the</span></span></span>
<span class="r-in"><span><span class="co"># two knots for unbounded intervals.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span>  <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Quadratic and linear splines, respectively: </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp.quad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">sp.lin</span>  <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span>          </span></span>
<span class="r-in"><span><span class="co"># When the same degree is used for all</span></span></span>
<span class="r-in"><span><span class="co"># intervals and knots, it suffices to give it once: </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp.quad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">sp.lin</span>  <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>  </span></span>
<span class="r-in"><span>     </span></span>
<span class="r-in"><span><span class="co"># An easy way to specify a model in which a knot is dropped</span></span></span>
<span class="r-in"><span><span class="co"># is to force a degree of continuity equal to the degree of adjoining</span></span></span>
<span class="r-in"><span><span class="co"># polynomials, e.g.  to drop the knot at 10, use: </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp.1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span>     </span></span>
<span class="r-in"><span><span class="co"># This is sometimes easier than laboriously rewriting the </span></span></span>
<span class="r-in"><span><span class="co"># spline function for each null hypothesis.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Depending on the maximal degree of the spline, the range of x should not be</span></span></span>
<span class="r-in"><span><span class="co"># excessive to avoid numerical problems. The spline matrix generated is 'raw'</span></span></span>
<span class="r-in"><span><span class="co"># and values of max(abs(x))^max(degree) may appear in the matrix.  For</span></span></span>
<span class="r-in"><span><span class="co"># example, for a cubic spline, it might be desirable to rescale x and/or</span></span></span>
<span class="r-in"><span><span class="co"># recenter x so abs(x) &lt; 100 if that is not already the case. Note that the</span></span></span>
<span class="r-in"><span><span class="co"># knots need to be correspondingly transformed.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The naming of coefficients should allow them to be easily interpreted.  For</span></span></span>
<span class="r-in"><span><span class="co"># example: </span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/zapsmall.html" class="external-link">zapsmall</a></span><span class="op">(</span> <span class="fu">gsp</span> <span class="op">(</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       D1(0) D2(0) C(3).2   C(3).3 C(7).2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]     0   0.0    0.0  0.00000    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]     1   0.5    0.0  0.00000    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]     2   2.0    0.0  0.00000    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]     3   4.5    0.0  0.00000    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]     4   8.0    0.5  0.16667    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]     5  12.5    2.0  1.33333    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]     6  18.0    4.5  4.50000    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]     7  24.5    8.0 10.66667    0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]     8  32.0   12.5 20.66667    0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,]     9  40.5   18.0 34.66667    2.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]    10  50.0   24.5 52.66667    4.5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Output:</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">##       D1(0) D2(0) C(3).2   C(3).3 C(7).2</span></span></span>
<span class="r-in"><span><span class="co">## f(0)      0   0.0    0.0  0.00000    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(1)      1   0.5    0.0  0.00000    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(2)      2   2.0    0.0  0.00000    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(3)      3   4.5    0.0  0.00000    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(4)      4   8.0    0.5  0.16667    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(5)      5  12.5    2.0  1.33333    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(6)      6  18.0    4.5  4.50000    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(7)      7  24.5    8.0 10.66667    0.0</span></span></span>
<span class="r-in"><span><span class="co">## f(8)      8  32.0   12.5 20.66667    0.5</span></span></span>
<span class="r-in"><span><span class="co">## f(9)      9  40.5   18.0 34.66667    2.0</span></span></span>
<span class="r-in"><span><span class="co">## f(10)    10  50.0   24.5 52.66667    4.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The coefficient for the first regressor is the first derivative at x = 0;</span></span></span>
<span class="r-in"><span><span class="co"># for the second regressor, the second derivative at 0; the third, the saltus</span></span></span>
<span class="r-in"><span><span class="co"># (change) in the second derivative at x = 3, the fourth, the saltus in the</span></span></span>
<span class="r-in"><span><span class="co"># third derivative at x = 3 and, finally, the saltus in the second derivative</span></span></span>
<span class="r-in"><span><span class="co"># at x = 7.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span> <span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">zd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>, <span class="fl">.5</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">.5</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html" class="external-link">sp</a></span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span>, <span class="va">zd</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ sp(x), data = zd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -1.6191 -0.5150 -0.1448  0.6308  1.4348 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.4005     0.7810  -0.513  0.61554   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(x)D1(0)    0.1548     1.0041   0.154  0.87956   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(x)D2(0)    2.1077     0.5246   4.018  0.00112 **</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(x)C(3).2  -1.0532     1.3937  -0.756  0.46155   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(x)C(3).3   0.4386     0.4674   0.938  0.36289   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(x)C(7).2  -0.8416     1.3937  -0.604  0.55499   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9322 on 15 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.9994,	Adjusted R-squared:  0.9992 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic:  4726 on 5 and 15 DF,  p-value: &lt; 2.2e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">Ls</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fl">0</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span> <span class="va">sp</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">7</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>              D <span class="op">=</span> <span class="fl">3</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/zapsmall.html" class="external-link">zapsmall</a></span><span class="op">(</span><span class="va">Ls</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 D1(0) D2(0) C(3).2 C(3).3 C(7).2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(1)         0     0     0      0      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(2)         0     0     0      0      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(3-)        0     0     0      0      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(3+)        0     0     0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(3+)-D3(3-) 0     0     0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(5)         0     0     0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(7-)        0     0     0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(7+)        0     0     0      0      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(7+)-D3(7-) 0     0     0      0     -1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(8)         0     0     0      0      0      0</span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## Output:</span></span></span>
<span class="r-in"><span><span class="co">##                 D1(0) D2(0) C(3).2 C(3).3 C(7).2</span></span></span>
<span class="r-in"><span><span class="co">## D3(1)         0     0     0      0      0      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(2)         0     0     0      0      0      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(3-)        0     0     0      0      0      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(3+)        0     0     0      0      1      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(3+)-D3(3-) 0     0     0      0      1      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(5)         0     0     0      0      1      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(7-)        0     0     0      0      1      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(7+)        0     0     0      0      0      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(7+)-D3(7-) 0     0     0      0     -1      0</span></span></span>
<span class="r-in"><span><span class="co">## D3(8)         0     0     0      0      0      0</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span> <span class="va">fit</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">'third derivatives'</span> <span class="op">=</span> <span class="va">Ls</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>no non-missing arguments to min; returning Inf</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>no non-missing arguments to min; returning Inf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   numDF denDF   F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> third derivatives     1    15 0.8806403 0.36289</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate  Std.Error DF  t-value   p-value Lower 0.95 Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(1)          0.000000 0.000000   15 -1.657173 0.11825  0.000000  0.000000  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(2)          0.000000 0.000000   15 -1.657173 0.11825  0.000000  0.000000  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(3-)         0.000000 0.000000   15 -1.657173 0.11825  0.000000  0.000000  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(3+)         0.438599 0.467378   15  0.938424 0.36289 -0.557594  1.434793  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(3+)-D3(3-)  0.438599 0.467378   15  0.938424 0.36289 -0.557594  1.434793  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(5)          0.438599 0.467378   15  0.938424 0.36289 -0.557594  1.434793  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(7-)         0.438599 0.467378   15  0.938424 0.36289 -0.557594  1.434793  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(7+)         0.000000 0.000000  Inf       NaN     NaN  0.000000  0.000000  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(7+)-D3(7-) -0.438599 0.467378   15 -0.938424 0.36289 -1.434793  0.557594  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D3(8)          0.000000 0.000000  Inf       NaN     NaN  0.000000  0.000000  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Output:</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">##                   numDF denDF  F.value p.value</span></span></span>
<span class="r-in"><span><span class="co">## third derivatives     1    15 2.184522 0.16009</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">##           ?     Estimate Std.Error  DF   t-value p-value Lower 0.95 Upper 0.95</span></span></span>
<span class="r-in"><span><span class="co">## D3(1)          0.000000  0.000000  15  2.408694 0.02932   0.000000   0.000000</span></span></span>
<span class="r-in"><span><span class="co">## D3(2)          0.000000  0.000000  15  2.408694 0.02932   0.000000   0.000000</span></span></span>
<span class="r-in"><span><span class="co">## D3(3-)         0.000000  0.000000  15  2.408694 0.02932   0.000000   0.000000</span></span></span>
<span class="r-in"><span><span class="co">## D3(3+)        -0.535959  0.362621  15 -1.478013 0.16009  -1.308867   0.236950</span></span></span>
<span class="r-in"><span><span class="co">## D3(3+)-D3(3-) -0.535959  0.362621  15 -1.478013 0.16009  -1.308867   0.236950</span></span></span>
<span class="r-in"><span><span class="co">## D3(5)         -0.535959  0.362621  15 -1.478013 0.16009  -1.308867   0.236950</span></span></span>
<span class="r-in"><span><span class="co">## D3(7-)        -0.535959  0.362621  15 -1.478013 0.16009  -1.308867   0.236950</span></span></span>
<span class="r-in"><span><span class="co">## D3(7+)         0.000000  0.000000 Inf       NaN     NaN   0.000000   0.000000</span></span></span>
<span class="r-in"><span><span class="co">## D3(7+)-D3(7-)  0.535959  0.362621  15  1.478013 0.16009  -0.236950   1.308867</span></span></span>
<span class="r-in"><span><span class="co">## D3(8)          0.000000  0.000000 Inf       NaN     NaN   0.000000   0.000000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that some coefficients that are 0 by design may lead to invalid degrees</span></span></span>
<span class="r-in"><span><span class="co"># of freedom and t-values.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># sc generates a portion of a hypothesis matrix for the coefficients of</span></span></span>
<span class="r-in"><span><span class="co"># a general spline constructed with gsp With: </span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># sc( sp, x, D, type ):</span></span></span>
<span class="r-in"><span><span class="co"># sp is the spline function for which coefficients </span></span></span>
<span class="r-in"><span><span class="co">#           are required, </span></span></span>
<span class="r-in"><span><span class="co"># x is the vector of values at which the spline is evaluated, </span></span></span>
<span class="r-in"><span><span class="co"># D is the order of derivatives: 0 = value of spline, </span></span></span>
<span class="r-in"><span><span class="co">#        1 = first derivative, etc.,  </span></span></span>
<span class="r-in"><span><span class="co"># type at knots: 0 limit from the left, 1 from the</span></span></span>
<span class="r-in"><span><span class="co">#       right, 2 is saltus (i.e. jump from left to right) </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Warning: sc will not work correctly if the function defining the</span></span></span>
<span class="r-in"><span><span class="co"># spline transforms the variable, e.g. sp &lt;- function(x) gsp( x/100, knot=2 )</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">simd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">2</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                    G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>,<span class="st">"female"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">25</span>,<span class="fl">40</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>          degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>          smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html" class="external-link">sp</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">*</span><span class="va">G</span>, <span class="va">simd</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> , <span class="va">simd</span>, groups <span class="op">=</span> <span class="va">G</span>,type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="gsp-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ sp(age) * G, data = simd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.0706 -0.9907  0.1145  0.7356  3.5746 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          -0.308758   0.656781  -0.470    0.639</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)D1(0)          0.034372   0.059876   0.574    0.567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(10).2       -0.005201   0.007501  -0.693    0.490</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(25).2        0.009226   0.013981   0.660    0.511</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gmale                 1.299734   0.928829   1.399    0.165</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)D1(0):Gmale   -0.123412   0.084677  -1.457    0.148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(10).2:Gmale  0.014301   0.010608   1.348    0.181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sp(age)C(25).2:Gmale -0.020697   0.019772  -1.047    0.298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 1.329 on 92 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.04003,	Adjusted R-squared:  -0.03301 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 0.548 on 7 and 92 DF,  p-value: 0.7958</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">L0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>    <span class="st">"hat"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>         <span class="st">"females at age=20"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span> <span class="op">*</span> <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>         <span class="st">"males at age=20"</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">*</span> <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"male-female"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>         <span class="st">"at 20"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">0</span> , <span class="fl">0</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">L0</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     numDF denDF   F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hat     2    92 0.5038175 0.60588</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Estimate  Std.Error DF t-value   p-value Lower 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> females at age=20  0.118632 0.353869  92  0.335242 0.73821 -0.584182 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> males at age=20   -0.334822 0.353869  92 -0.946175 0.34654 -1.037636 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> females at age=20 0.821445  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> males at age=20   0.367992  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             numDF denDF   F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> male-female     1    92 0.8210152 0.36725</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Estimate  Std.Error DF t-value   p-value Lower 0.95 Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> at 20 -0.453453 0.500446  92 -0.906099 0.36725 -1.447382  0.540475  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">L1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"D(yhat)/D(age)"</span> <span class="op">=</span> </span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="st">"female at age = 25"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    <span class="st">"male at x = 25"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">*</span><span class="fu"><a href="sc.html">sc</a></span><span class="op">(</span><span class="va">sp</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span> <span class="va">fit</span>, <span class="va">L1</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                numDF denDF   F-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D(yhat)/D(age)     2    92 0.5435317 0.58255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Estimate  Std.Error DF t-value   p-value Lower 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> female at age = 25 -0.043645 0.061842  92 -0.705754 0.48212 -0.166469 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> male at x = 25      0.047460 0.061842  92  0.767447 0.44478 -0.075363 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Upper 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> female at age = 25 0.079178  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> male at x = 25     0.170284  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A periodic spline function can be generated by forcing the coefficients</span></span></span>
<span class="r-in"><span><span class="co"># beyond a periodic knot to repeat the pattern in a previous inteval. For</span></span></span>
<span class="r-in"><span><span class="co"># example a periodic spline of period 1 can be created as follows:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">.01</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">per.sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>                    knots <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>                    degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                    smoothness <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                    lin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/spida2/man/PolyShift.html" class="external-link">PolyShift</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">per.sp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>number of items to replace is not a multiple of replacement length</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ per.sp(x))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min       1Q   Median       3Q      Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.14319 -0.66641  0.00445  0.68987  2.77613 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -0.06976    0.07872  -0.886    0.376</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)    0.58880    0.80730   0.729    0.466</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 1.007 on 599 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.0008873,	Adjusted R-squared:  -0.0007807 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 0.5319 on 1 and 599 DF,  p-value: 0.4661</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , </span></span>
<span class="r-in"><span>        panel <span class="op">=</span> <span class="va">panel.superpose.2</span>,</span></span>
<span class="r-in"><span>        type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>,<span class="st">"l"</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="gsp-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="gsp-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A periodic spline with additional knots can be created as shown below. Note</span></span></span>
<span class="r-in"><span><span class="co"># that constraint matrix 'lin' expresses constraints for the 'full' polynomial</span></span></span>
<span class="r-in"><span><span class="co"># parametrization, i.e. polynomials of degree 3 (thus of order 4 when</span></span></span>
<span class="r-in"><span><span class="co"># including the constant term) in each of the 4 intervals.  The constraint</span></span></span>
<span class="r-in"><span><span class="co"># given in 'lin' forces the coefficients beyond the periodic knot at x = 1, to</span></span></span>
<span class="r-in"><span><span class="co"># repeat the polynomial in the interval just to the right of x = 0.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">.01</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">per.sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">gsp</span><span class="op">(</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.333</span>,<span class="fl">.666</span>,<span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                degree <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                smoothness <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>                lin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/spida2/man/PolyShift.html" class="external-link">PolyShift</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">per.sp</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>number of items to replace is not a multiple of replacement length</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y ~ per.sp(x))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min       1Q   Median       3Q      Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.09781 -0.63961  0.01433  0.61510  2.79299 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          -0.1166     0.1420  -0.821    0.412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)D1(0)        0.2981     1.8606   0.160    0.873</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)D2(0)        3.6825    12.0977   0.304    0.761</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)D3(0)      -28.2747    38.3566  -0.737    0.461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)C(0.333).2   3.9969    34.2968   0.117    0.907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> per.sp(x)C(0.333).3  34.1073   174.2618   0.196    0.845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9417 on 595 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.00146,	Adjusted R-squared:  -0.006932 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 0.1739 on 5 and 595 DF,  p-value: 0.9723</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , </span></span>
<span class="r-in"><span>   panel <span class="op">=</span> <span class="va">panel.superpose.2</span>,type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>,<span class="st">"l"</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="gsp-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span> , type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gsp-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Smoothing splines</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘MASS’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:spida2’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Null</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Spruce</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Spruce</span><span class="op">$</span><span class="va">all</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span> <span class="va">Spruce</span><span class="op">$</span><span class="va">days</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 152 674</span>
<span class="r-in"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">smsp</span> <span class="op">(</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="fl">150</span>, <span class="fl">675</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spruce.fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></span><span class="op">(</span><span class="va">logSize</span> <span class="op">~</span> <span class="va">days</span>, data<span class="op">=</span><span class="va">Spruce</span>,</span></span>
<span class="r-in"><span>          random<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>all<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/pdIdent.html" class="external-link">pdIdent</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html" class="external-link">sp</a></span><span class="op">(</span><span class="va">days</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          plot<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, Tree<span class="op">=</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spruce.fit1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Linear mixed-effects model fit by REML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Data: Spruce </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         AIC       BIC   logLik</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -178.6444 -149.0497 95.32222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: ~sp(days) - 1 | all</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Structure: Multiple of an Identity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            sp(days)1    sp(days)2    sp(days)3    sp(days)4    sp(days)5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            sp(days)6    sp(days)7    sp(days)8    sp(days)9   sp(days)10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)11   sp(days)12   sp(days)13   sp(days)14   sp(days)15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)16   sp(days)17   sp(days)18   sp(days)19   sp(days)20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)21   sp(days)22   sp(days)23   sp(days)24   sp(days)25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)26   sp(days)27   sp(days)28   sp(days)29   sp(days)30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)31   sp(days)32   sp(days)33   sp(days)34   sp(days)35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)36   sp(days)37   sp(days)38   sp(days)39   sp(days)40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)41   sp(days)42   sp(days)43   sp(days)44   sp(days)45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)46   sp(days)47   sp(days)48   sp(days)49   sp(days)50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)51   sp(days)52   sp(days)53   sp(days)54   sp(days)55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)56   sp(days)57   sp(days)58   sp(days)59   sp(days)60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)61   sp(days)62   sp(days)63   sp(days)64   sp(days)65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)66   sp(days)67   sp(days)68   sp(days)69   sp(days)70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)71   sp(days)72   sp(days)73   sp(days)74   sp(days)75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)76   sp(days)77   sp(days)78   sp(days)79   sp(days)80</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)81   sp(days)82   sp(days)83   sp(days)84   sp(days)85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)86   sp(days)87   sp(days)88   sp(days)89   sp(days)90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)91   sp(days)92   sp(days)93   sp(days)94   sp(days)95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           sp(days)96   sp(days)97   sp(days)98   sp(days)99  sp(days)100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          sp(days)101  sp(days)102  sp(days)103  sp(days)104</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev: 0.0007612821 0.0007612821 0.0007612821 0.0007612821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: ~1 | plot %in% all</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         (Intercept)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev:  0.08906115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: ~1 | Tree %in% plot %in% all</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         (Intercept)  Residual</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev:   0.6217287 0.1765077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:  logSize ~ days </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Value  Std.Error  DF  t-value p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 4.434371 0.11731520 947 37.79878       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> days        0.002869 0.00010015 947 28.64802       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Correlation: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      (Intr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> days -0.676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standardized Within-Group Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Min           Q1          Med           Q3          Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -4.434020668 -0.482853721 -0.007043871  0.535846275  6.674432905 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Observations: 1027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Groups: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     all           plot %in% all Tree %in% plot %in% all </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       1                       4                      79 </span>
<span class="r-in"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span> days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="fl">160</span>, <span class="fl">670</span>, <span class="fl">10</span><span class="op">)</span>, all <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pred</span><span class="op">$</span><span class="va">logSize</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> <span class="va">spruce.fit1</span>, newdata <span class="op">=</span> <span class="va">pred</span>, level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span> <span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="va">logSize</span> <span class="op">~</span> <span class="va">days</span>, <span class="va">pred</span>, type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gsp-12.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Georges Monette.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a data frame at a higher level of aggregation — up • spida2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a data frame at a higher level of aggregation — up"><meta name="description" content="Produce a higher level data set with one row per cluster. The data set can
contain only variables that are invariant in each cluster or it can also
include summaries (mean or modes) of variables that vary by cluster. Adapted
from gsummary in the nlme package."><meta property="og:description" content="Produce a higher level data set with one row per cluster. The data set can
contain only variables that are invariant in each cluster or it can also
include summaries (mean or modes) of variables that vary by cluster. Adapted
from gsummary in the nlme package."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spida2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/spida2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/generalParametricSplines_v2.html">General Parametric Splines in carEx v.2</a></li>
    <li><a class="dropdown-item" href="../articles/generalParametricSplines.html">General Parametric Splines in carEx</a></li>
    <li><a class="dropdown-item" href="../articles/pdInd.html">pdInd</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmonette/spida2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a data frame at a higher level of aggregation</h1>
      <small class="dont-index">Source: <a href="https://github.com/gmonette/spida2/blob/HEAD/R/up.R" class="external-link"><code>R/up.R</code></a></small>
      <div class="d-none name"><code>up.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produce a higher level data set with one row per cluster. The data set can
contain only variables that are invariant in each cluster or it can also
include summaries (mean or modes) of variables that vary by cluster. Adapted
from <code>gsummary</code> in the <code>nlme</code> package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">up</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  form <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>,</span>
<span>  agg <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sep.agg <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>  freq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sep.freq <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>  all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"/"</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="va">na.rm</span><span class="op">)</span>,</span>
<span>  omitGroupingFactor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">groups</span>,</span>
<span>  invariantsOnly <span class="op">=</span> <span class="op">!</span><span class="va">all</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a data frame to be aggregated.</p></dd>


<dt id="arg-form">form<a class="anchor" aria-label="anchor" href="#arg-form"></a></dt>
<dd><p>a one-sided formula identifying the variable(s) in <code>object</code>
that identifies clusters. e.g. ~ school/Sex to get a summary within each Sex
of each school.</p></dd>


<dt id="arg-agg">agg<a class="anchor" aria-label="anchor" href="#arg-agg"></a></dt>
<dd><p>(NEW: Aug 2016) a one-sided formula identifying variables to be aggregated,
i.e. variables that vary within clusters and that need to be aggregated
(within-cluster mean for numeric variables and within-cluster incidence
proportions for factors). Default: NULL</p></dd>


<dt id="arg-sep-agg">sep.agg<a class="anchor" aria-label="anchor" href="#arg-sep-agg"></a></dt>
<dd><p>(NEW: Aug 2016) separator between factor names and factor
level for within-cluster incidence proportions. Default: '_'</p></dd>


<dt id="arg-freq">freq<a class="anchor" aria-label="anchor" href="#arg-freq"></a></dt>
<dd><p>(NEW: Nov 2018) a one-sided formula identifying character variables to
be represented according the frequencies of their levels,
i.e. variables that vary withing cluster and that need to be aggregated
(within-cluster sum for numeric variables and within-cluster frequencies
for factors). Default: NULL</p></dd>


<dt id="arg-sep-freq">sep.freq<a class="anchor" aria-label="anchor" href="#arg-sep-freq"></a></dt>
<dd><p>(NEW: Nove 2018) separator between factor names and factor
level for within-cluster incidence frequencies. Default: '_'</p></dd>


<dt id="arg-all">all<a class="anchor" aria-label="anchor" href="#arg-all"></a></dt>
<dd><p>if TRUE, include summaries of variables that vary within
clusters, otherwise keep only cluster-invariant variables and variables
listed in 'agg'</p></dd>


<dt id="arg-sep">sep<a class="anchor" aria-label="anchor" href="#arg-sep"></a></dt>
<dd><p>separator to form cluster names combining more than one
clustering variables.  If the separator leads to the same name for distinct
clusters (e.g. if var1 has levels 'a' and 'a/b' and var2 has levels 'b/c'
and 'c') the function produces an error and a different separator should be
used.</p></dd>


<dt id="arg-fun">FUN<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>function to be used for summaries.</p></dd>


<dt id="arg-omitgroupingfactor">omitGroupingFactor<a class="anchor" aria-label="anchor" href="#arg-omitgroupingfactor"></a></dt>
<dd><p>kept for compatibility with <code>gsummary</code></p></dd>


<dt id="arg-groups">groups<a class="anchor" aria-label="anchor" href="#arg-groups"></a></dt>
<dd><p>kept for compatibility with <code>gsummary</code></p></dd>


<dt id="arg-invariantsonly">invariantsOnly<a class="anchor" aria-label="anchor" href="#arg-invariantsonly"></a></dt>
<dd><p>kept for compatibility with <code>gsummary</code></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments to <code>tapply</code> when summarizing
numerical variables. e.g. <code>na.rm = TRUE</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a data frame with one row per combination of values of the variable(s) in <code>form</code>.
The number of rows for each combination is retuned in a variable 'Freq'.
Frequencies (proportions) of values for each variable specified
by '~freq' ('~agg') are also included.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>up</code> was created from <code><a href="https://rdrr.io/pkg/nlme/man/gsummary.html" class="external-link">nlme::gsummary</a></code> and modified to make it
easier to use and to make an equivalent of <code>gsummary</code> available when
using <code>lme4</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>adapted by G. Monette from gsummary in 'nlme' by Bates &amp; Pinheiro</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">hs</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span> <span class="va">hs</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1977    9</span>
<span class="r-in"><span>    <span class="va">hsu</span> <span class="op">&lt;-</span> <span class="fu">up</span><span class="op">(</span> <span class="va">hs</span>, <span class="op">~</span> <span class="va">school</span> <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span> <span class="va">hsu</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 40  6</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># to also get cluster means of cluster-varying numeric variables and modes of factors:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="va">hsa</span> <span class="op">&lt;-</span> <span class="fu">up</span><span class="op">(</span> <span class="va">hs</span>, <span class="op">~</span> <span class="va">school</span> , all <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># to get summary proportions of cluster varying factors:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu">up</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">hs</span>, <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">Sex</span> <span class="op">-</span><span class="fl">1</span> , <span class="va">hs</span><span class="op">)</span><span class="op">)</span>, <span class="op">~</span> <span class="va">school</span>, all <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      school   mathach         ses    Sex Minority Size   Sector PRACAD DISCLIM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1317   1317 13.177687  0.34533333 Female      Yes  455 Catholic   0.95  -1.694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1906   1906 15.983170  0.51162264 Female       No  400 Catholic   0.87  -0.939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2208   2208 15.404667  0.42316667 Female       No 1061 Catholic   0.68  -0.864</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2458   2458 13.985684  0.22778947 Female      Yes  545 Catholic   0.89  -1.484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2626   2626 13.396605 -0.06484211   Male       No 2142   Public   0.40   0.142</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2629   2629 14.907772 -0.13764912   Male       No 1314 Catholic   0.81  -0.613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2639   2639  6.615476 -0.96442857 Female      Yes 2713   Public   0.14  -0.282</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2658   2658 13.396156  0.43844444 Female       No  780 Catholic   0.79  -0.961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2771   2771 11.844109 -0.33945455 Female       No  415   Public   0.24   1.048</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3013   3013 12.610830 -0.04422642   Male       No  760   Public   0.56  -0.213</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3610   3610 15.354953  0.12012500   Male       No 1431 Catholic   0.80  -0.621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3992   3992 14.645208  0.36539623   Male       No 1114 Catholic   0.73  -1.534</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4292   4292 12.864354 -0.48615385   Male      Yes 1328 Catholic   0.76  -0.674</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4511   4511 13.409034 -0.10713793 Female       No 1068 Catholic   0.52  -1.872</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4530   4530  9.055698 -0.59688889 Female       No  435 Catholic   0.60  -0.245</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4868   4868 12.310176  0.36111765   Male       No  657 Catholic   1.00  -0.219</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5619   5619 15.416242  0.42033333   Male       No 1118 Catholic   0.77  -1.286</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5640   5640 13.160105 -0.17659649   Male       No 1152   Public   0.41   0.256</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5650   5650 14.273533  0.02244444 Female      Yes  720 Catholic   0.60  -0.070</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5720   5720 14.282302  0.03256604   Male       No  381 Catholic   0.65  -0.352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5761   5761 11.138058 -0.32300000 Female       No  215 Catholic   0.63  -0.892</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5762   5762  4.324865 -1.19394595 Female      Yes 1826   Public   0.24   0.364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6074   6074 13.779089 -0.27675000 Female       No 2051 Catholic   0.32  -1.018</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6484   6484 12.912400 -0.18514286 Female       No  726   Public   0.19   0.218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6897   6897 15.097633  0.34955102 Female       No 1415   Public   0.55  -0.361</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7172   7172  8.066818 -0.28981818 Female      Yes  280 Catholic   0.05   1.013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7232   7232 12.542635 -0.09011538 Female       No 1154   Public   0.20   0.975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7342   7342 11.166414 -0.44782759   Male       No 1220 Catholic   0.46   0.380</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7345   7345 11.338554  0.03325000 Female       No  978   Public   0.64   0.336</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7688   7688 18.422315  0.18588889   Male       No 1410 Catholic   0.65  -0.575</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7697   7697 15.721781  0.25825000   Male       No 1734   Public   0.20   0.279</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7890   7890  8.341098 -0.52270588   Male       No  311   Public   0.21   0.845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7919   7919 14.849973  0.45767568   Male       No 1451   Public   0.50  -0.402</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8531   8531 13.528683  0.40809756 Female       No 2190   Public   0.58   0.132</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8627   8627 10.883717  0.10483019   Male       No 2452   Public   0.25   0.742</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8707   8707 12.883938  0.15512500 Female       No 1133   Public   0.48   1.542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8854   8854  4.239781 -0.75675000 Female       No  745   Public   0.18  -0.228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8874   8874 12.055028 -0.34077778 Female       No 2650   Public   0.20   1.742</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9550   9550 11.089138  0.05303448 Female       No 1532   Public   0.45   0.791</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9586   9586 14.863695  0.62115254 Female       No  262 Catholic   1.00  -2.416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      SexFemale   SexMale Freq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1317 1.0000000 0.0000000   48</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1906 0.5094340 0.4905660   53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2208 0.5833333 0.4166667   60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2458 1.0000000 0.0000000   57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2626 0.4736842 0.5263158   38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2629 0.0000000 1.0000000   57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2639 0.5714286 0.4285714   42</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2658 0.6000000 0.4000000   45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2771 0.5090909 0.4909091   55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3013 0.3584906 0.6415094   53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3610 0.4531250 0.5468750   64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3992 0.3962264 0.6037736   53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4292 0.0000000 1.0000000   65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4511 1.0000000 0.0000000   58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4530 1.0000000 0.0000000   63</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4868 0.3235294 0.6764706   34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5619 0.4545455 0.5454545   66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5640 0.4210526 0.5789474   57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5650 0.7111111 0.2888889   45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5720 0.4528302 0.5471698   53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5761 1.0000000 0.0000000   52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5762 0.5675676 0.4324324   37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6074 1.0000000 0.0000000   56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6484 0.5714286 0.4285714   35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6897 0.5918367 0.4081633   49</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7172 0.5000000 0.5000000   44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7232 0.5769231 0.4230769   52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7342 0.0000000 1.0000000   58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7345 0.5178571 0.4821429   56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7688 0.0000000 1.0000000   54</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7697 0.3437500 0.6562500   32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7890 0.4705882 0.5294118   51</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7919 0.4324324 0.5675676   37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8531 0.5609756 0.4390244   41</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8627 0.4528302 0.5471698   53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8707 0.5416667 0.4583333   48</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8854 0.5312500 0.4687500   32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8874 0.5833333 0.4166667   36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9550 0.6551724 0.3448276   29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9586 1.0000000 0.0000000   59</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Similar using 'agg'</span></span></span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span>    <span class="fu">up</span><span class="op">(</span><span class="va">hs</span>, <span class="op">~</span><span class="va">school</span>, agg <span class="op">=</span> <span class="op">~</span> <span class="va">Sex</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      school Size   Sector PRACAD DISCLIM Freq Sex_Female  Sex_Male</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1317   1317  455 Catholic   0.95  -1.694   48  1.0000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1906   1906  400 Catholic   0.87  -0.939   53  0.5094340 0.4905660</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2208   2208 1061 Catholic   0.68  -0.864   60  0.5833333 0.4166667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2458   2458  545 Catholic   0.89  -1.484   57  1.0000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2626   2626 2142   Public   0.40   0.142   38  0.4736842 0.5263158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2629   2629 1314 Catholic   0.81  -0.613   57  0.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2639   2639 2713   Public   0.14  -0.282   42  0.5714286 0.4285714</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2658   2658  780 Catholic   0.79  -0.961   45  0.6000000 0.4000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2771   2771  415   Public   0.24   1.048   55  0.5090909 0.4909091</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3013   3013  760   Public   0.56  -0.213   53  0.3584906 0.6415094</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3610   3610 1431 Catholic   0.80  -0.621   64  0.4531250 0.5468750</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3992   3992 1114 Catholic   0.73  -1.534   53  0.3962264 0.6037736</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4292   4292 1328 Catholic   0.76  -0.674   65  0.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4511   4511 1068 Catholic   0.52  -1.872   58  1.0000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4530   4530  435 Catholic   0.60  -0.245   63  1.0000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4868   4868  657 Catholic   1.00  -0.219   34  0.3235294 0.6764706</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5619   5619 1118 Catholic   0.77  -1.286   66  0.4545455 0.5454545</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5640   5640 1152   Public   0.41   0.256   57  0.4210526 0.5789474</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5650   5650  720 Catholic   0.60  -0.070   45  0.7111111 0.2888889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5720   5720  381 Catholic   0.65  -0.352   53  0.4528302 0.5471698</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5761   5761  215 Catholic   0.63  -0.892   52  1.0000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5762   5762 1826   Public   0.24   0.364   37  0.5675676 0.4324324</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6074   6074 2051 Catholic   0.32  -1.018   56  1.0000000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6484   6484  726   Public   0.19   0.218   35  0.5714286 0.4285714</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6897   6897 1415   Public   0.55  -0.361   49  0.5918367 0.4081633</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7172   7172  280 Catholic   0.05   1.013   44  0.5000000 0.5000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7232   7232 1154   Public   0.20   0.975   52  0.5769231 0.4230769</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7342   7342 1220 Catholic   0.46   0.380   58  0.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7345   7345  978   Public   0.64   0.336   56  0.5178571 0.4821429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7688   7688 1410 Catholic   0.65  -0.575   54  0.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7697   7697 1734   Public   0.20   0.279   32  0.3437500 0.6562500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7890   7890  311   Public   0.21   0.845   51  0.4705882 0.5294118</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7919   7919 1451   Public   0.50  -0.402   37  0.4324324 0.5675676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8531   8531 2190   Public   0.58   0.132   41  0.5609756 0.4390244</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8627   8627 2452   Public   0.25   0.742   53  0.4528302 0.5471698</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8707   8707 1133   Public   0.48   1.542   48  0.5416667 0.4583333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8854   8854  745   Public   0.18  -0.228   32  0.5312500 0.4687500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8874   8874 2650   Public   0.20   1.742   36  0.5833333 0.4166667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9550   9550 1532   Public   0.45   0.791   29  0.6551724 0.3448276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9586   9586  262 Catholic   1.00  -2.416   59  1.0000000 0.0000000</span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span>    <span class="co">## To plot a summary between-cluster panel along with within-cluster panels:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="va">hsu</span> <span class="op">&lt;-</span> <span class="fu">up</span><span class="op">(</span> <span class="va">hs</span>, <span class="op">~</span> <span class="va">school</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">hsu</span><span class="op">$</span><span class="va">school</span> <span class="op">&lt;-</span> <span class="st">' between'</span>  <span class="co"># space to make it come lexicographically before cluster names</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span> <span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span> <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span> <span class="va">mathach</span> <span class="op">~</span> <span class="va">ses</span> <span class="op">|</span> <span class="va">school</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">hs</span>,<span class="va">hsu</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        panel <span class="op">=</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.xyplot.html" class="external-link">panel.xyplot</a></span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.functions.html" class="external-link">panel.lmline</a></span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span> <span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in rbind(deparse.level, ...):</span> numbers of columns of arguments do not match</span>
<span class="r-in"><span>        </span></span>
<span class="r-in"><span>    <span class="co">## To create a data frame grouped by predictors with frequency variables for each</span></span></span>
<span class="r-in"><span>    <span class="co">## level of a response variable for analysis with a binomial glm with goodness of fit</span></span></span>
<span class="r-in"><span>    <span class="co">## based on the deviance</span></span></span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span>    <span class="va">hsa</span> <span class="op">&lt;-</span> <span class="fu">up</span><span class="op">(</span> <span class="va">hs</span>, <span class="op">~</span><span class="va">school</span>, freq <span class="op">=</span> <span class="op">~</span> <span class="va">Sex</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in FUN(X[[i]], ...):</span> invalid 'type' (closure) of argument</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hsa</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      school  mathach         ses    Sex Minority Size   Sector PRACAD DISCLIM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1317   1317 13.17769  0.34533333 Female      Yes  455 Catholic   0.95  -1.694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1906   1906 15.98317  0.51162264 Female       No  400 Catholic   0.87  -0.939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2208   2208 15.40467  0.42316667 Female       No 1061 Catholic   0.68  -0.864</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2458   2458 13.98568  0.22778947 Female      Yes  545 Catholic   0.89  -1.484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2626   2626 13.39661 -0.06484211   Male       No 2142   Public   0.40   0.142</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2629   2629 14.90777 -0.13764912   Male       No 1314 Catholic   0.81  -0.613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Freq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1317   48</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1906   53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2208   60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2458   57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2626   38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2629   57</span>
<span class="r-in"><span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Sex_Female</span>, <span class="va">Sex_Male</span><span class="op">)</span> <span class="op">~</span> <span class="va">Sector</span>, <span class="va">hsa</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(predvars, data, env):</span> object 'Sex_Female' not found</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># the residual deviance provides a goodness of fit test</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'object' in selecting a method for function 'summary': object 'fit' not found</span>
<span class="r-in"><span>    </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Georges Monette.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>


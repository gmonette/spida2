<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Wide data set from long data set — towide • spida2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wide data set from long data set — towide"><meta name="description" content="Creates a wide data frame from a long data frame identifying
an 'id' variable and using a time variable whose values
provide suffixes for time-varying variable names in wide form."><meta property="og:description" content="Creates a wide data frame from a long data frame identifying
an 'id' variable and using a time variable whose values
provide suffixes for time-varying variable names in wide form."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spida2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/spida2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/generalParametricSplines_v2.html">General Parametric Splines in carEx v.2</a></li>
    <li><a class="dropdown-item" href="../articles/generalParametricSplines.html">General Parametric Splines in carEx</a></li>
    <li><a class="dropdown-item" href="../articles/pdInd.html">pdInd</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmonette/spida2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Wide data set from long data set</h1>
      <small class="dont-index">Source: <a href="https://github.com/gmonette/spida2/blob/HEAD/R/towide.R" class="external-link"><code>R/towide.R</code></a></small>
      <div class="d-none name"><code>towide.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a wide data frame from a long data frame identifying
an 'id' variable and using a time variable whose values
provide suffixes for time-varying variable names in wide form.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">towide</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  idvar <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  timevar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>  add.invariants <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data frame in 'long' form.</p></dd>


<dt id="arg-idvar">idvar<a class="anchor" aria-label="anchor" href="#arg-idvar"></a></dt>
<dd><p>(default: 'id') the variable(s) identifying each group of rows
that are transformed to a single row in the wide file.</p></dd>


<dt id="arg-timevar">timevar<a class="anchor" aria-label="anchor" href="#arg-timevar"></a></dt>
<dd><p>(default: 'time') the variable containing
the occasion names in the long file.</p></dd>


<dt id="arg-sep">sep<a class="anchor" aria-label="anchor" href="#arg-sep"></a></dt>
<dd><p>(default: '<em>') the character(s) that separate the name of
a time-varying variable in the long form
from the added suffix for the
correponding names in wide form. Default: '</em>'.</p></dd>


<dt id="arg-add-invariants">add.invariants<a class="anchor" aria-label="anchor" href="#arg-add-invariants"></a></dt>
<dd><p>(default TRUE) additional variables that are invariant
within clusters are kept in output even if not included in 'idvar'
(default: names(data)[gicc(data, dataidvar)]).
For all variables, except <code>idvar</code> to be treated as time-varying,
use <code>invar = NULL</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments are passed to <code><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a data frame in wide form in which each variable that varies
within levels of 'idvar' is turned into as many variables as there are
distinct values of 'timevar' using the values of 'timevar' as suffixes to
name the variables in wide form.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In contrast with reshape in stats, this function
identifies variables that
are invariant with respect to 'idvar' and does not
expand them to wide form.</p>
<p>Only 'time'-varying variables are expanded to wide form.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="tolong.html">tolong</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Subjects A, B observed on varying occasions, measuring variables</span></span></span>
<span class="r-in"><span><span class="co">#  x and y in different locations</span></span></span>
<span class="r-in"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                  y.left <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, y.right <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, </span></span>
<span class="r-in"><span>                  x.left<span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, x.right <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">13</span>, x.middle <span class="op">=</span> <span class="fl">21</span><span class="op">:</span><span class="fl">23</span> </span></span>
<span class="r-in"><span>                  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dd</span></span></span>
<span class="r-in"><span><span class="fu"><a href="tolong.html">tolong</a></span><span class="op">(</span><span class="va">dd</span>, sep <span class="op">=</span> <span class="st">'.'</span><span class="op">)</span> <span class="co"># uses 'time' as default name for occasions variable</span></span></span>
<span class="r-in"><span><span class="co"># Specify new 'timevar' to avoid clobbering 'time':</span></span></span>
<span class="r-in"><span><span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="tolong.html">tolong</a></span><span class="op">(</span><span class="va">dd</span>, sep <span class="op">=</span> <span class="st">'.'</span>, timevar <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">dl</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Back to wide format: Use 'idvar' to specify combination of </span></span></span>
<span class="r-in"><span><span class="co"># of variable values that uniquely identifies rows in wide file:</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, idvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'subject'</span>,<span class="st">'time'</span><span class="op">)</span>, timevar <span class="op">=</span> <span class="st">'location'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Long file with additional constants</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'head'</span>,<span class="st">'neck'</span>,<span class="st">'jaw'</span>,<span class="st">'chest'</span><span class="op">)</span><span class="op">[</span></span></span>
<span class="r-in"><span>                      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                 sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>,<span class="st">'female'</span>,<span class="st">'male'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 var1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,</span></span>
<span class="r-in"><span>                 var2 <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">18</span>,</span></span>
<span class="r-in"><span>                 invar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dl</span></span></span>
<span class="r-in"><span><span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'name'</span>,<span class="st">'sex'</span><span class="op">)</span>, <span class="st">'site'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Two indexing variable: e.g. hippocampal volume: 2 sides x 3 sites</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 side <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'left'</span>,<span class="st">'right'</span><span class="op">)</span>, <span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'head'</span>,<span class="st">'body'</span>,<span class="st">'tail'</span><span class="op">)</span>,each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 volume <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">18</span>,</span></span>
<span class="r-in"><span>                 grade <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">18</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                 sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'female'</span>,<span class="st">'male'</span>,<span class="st">'female'</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">43</span>, <span class="fl">69</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dl</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">dl.site</span> <span class="op">&lt;-</span> <span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'name'</span>,<span class="st">'side'</span><span class="op">)</span>, <span class="st">'site'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">dl.site.side</span> <span class="op">&lt;-</span> <span class="fu">towide</span><span class="op">(</span><span class="va">dl.site</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'name'</span><span class="op">)</span>, <span class="st">'side'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dl.site.side</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dl.site.side</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Switching long and wide variables</span></span></span>
<span class="r-in"><span><span class="co"># Multiple variables in 'idvar'</span></span></span>
<span class="r-in"><span><span class="co">#  </span></span></span>
<span class="r-in"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header<span class="op">=</span><span class="cn">T</span>,text<span class="op">=</span><span class="st">"</span></span></span>
<span class="r-in"><span><span class="st">country    variable   1990 1991 1992 1993</span></span></span>
<span class="r-in"><span><span class="st">Canada     population   20   21   24   26</span></span></span>
<span class="r-in"><span><span class="st">Canada     income       10   12   12   11</span></span></span>
<span class="r-in"><span><span class="st">Mexico     population   50   52   53   54</span></span></span>
<span class="r-in"><span><span class="st">Mexico     income       30   31   33   34</span></span></span>
<span class="r-in"><span><span class="st">"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">dd</span>                 </span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"^X"</span>,<span class="st">"val__"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dd</span><span class="op">)</span><span class="op">)</span> <span class="co"># use '__' in case '_' is used elsewhere                </span></span></span>
<span class="r-in"><span> <span class="va">dd</span></span></span>
<span class="r-in"><span> <span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="tolong.html">tolong</a></span><span class="op">(</span><span class="va">dd</span>, sep <span class="op">=</span> <span class="st">'__'</span>, timevar <span class="op">=</span> <span class="st">'year'</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">dl</span></span></span>
<span class="r-in"><span> <span class="va">dw</span> <span class="op">&lt;-</span> <span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, idvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'country'</span>,<span class="st">'year'</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        timevar <span class="op">=</span> <span class="st">'variable'</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">dw</span></span></span>
<span class="r-in"><span> <span class="va">dw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'^id_'</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span> <span class="va">dw</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"^val_"</span>,<span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">dw</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">#  A function to flip years and variables</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="va">flip</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">rowvar</span> <span class="op">=</span> <span class="st">'country'</span>, </span></span>
<span class="r-in"><span>                 <span class="va">colfmt</span> <span class="op">=</span> <span class="st">'[0-9]{4}$'</span>, </span></span>
<span class="r-in"><span>                 <span class="va">varname</span> <span class="op">=</span> <span class="st">'variable'</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">'__'</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"^.*("</span>,<span class="va">colfmt</span>,<span class="st">')'</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"value"</span>,<span class="va">sep</span>,<span class="st">"\\1"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="tolong.html">tolong</a></span><span class="op">(</span><span class="va">data</span>, sep <span class="op">=</span> <span class="st">"__"</span>, timevar <span class="op">=</span> <span class="st">'year'</span>, idvar <span class="op">=</span> <span class="st">"XXXX"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">dw</span> <span class="op">&lt;-</span> <span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, timevar <span class="op">=</span> <span class="va">varname</span>, idvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rowvar</span>, <span class="st">'year'</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">'__'</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">dw</span> <span class="op">&lt;-</span> <span class="va">dw</span><span class="op">[</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^XXXX"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'value'</span>,<span class="va">sep</span><span class="op">)</span>, <span class="st">''</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">dw</span></span></span>
<span class="r-in"><span><span class="op">}</span>     </span></span>
<span class="r-in"><span><span class="fu">flip</span><span class="op">(</span><span class="va">dd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#     </span></span></span>
<span class="r-in"><span><span class="co"># Mixture of time-varying and time-invariant variables</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'C'</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                 time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>,<span class="st">'male'</span>,<span class="st">'male'</span>,<span class="st">'female'</span>,<span class="st">'female'</span>,<span class="st">'male'</span>,<span class="st">'male'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">12</span><span class="op">)</span>, <span class="co"># accidentally time-invariant</span></span></span>
<span class="r-in"><span>                 x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">21</span>,<span class="fl">22</span>,<span class="fl">25</span>,<span class="fl">26</span>,<span class="fl">18</span>,<span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="co"># time-varying</span></span></span>
<span class="r-in"><span><span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, idvar <span class="op">=</span> <span class="st">'subject'</span>, timevar <span class="op">=</span> <span class="st">'time'</span><span class="op">)</span>  </span></span>
<span class="r-in"><span><span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, idvar <span class="op">=</span> <span class="st">'subject'</span>, timevar <span class="op">=</span> <span class="st">'time'</span>, add.invariants <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># multiple time variables: e.g. month, day</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'C'</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                 month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 day <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">15</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>,<span class="st">'male'</span>,<span class="st">'male'</span>,<span class="st">'female'</span>,<span class="st">'female'</span>,<span class="st">'male'</span>,<span class="st">'male'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">12</span><span class="op">)</span>, <span class="co"># accidentally time-invariant</span></span></span>
<span class="r-in"><span>                 x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">21</span>,<span class="fl">22</span>,<span class="fl">25</span>,<span class="fl">26</span>,<span class="fl">18</span>,<span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="co"># time-varying</span></span></span>
<span class="r-in"><span><span class="co"># need single time variable</span></span></span>
<span class="r-in"><span><span class="va">dl</span></span></span>
<span class="r-in"><span><span class="va">dl</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dl</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">month</span>,<span class="st">'-'</span>,<span class="va">day</span><span class="op">)</span>,<span class="st">'%m-%d'</span><span class="op">)</span><span class="op">)</span>  <span class="co"># uses the current year</span></span></span>
<span class="r-in"><span><span class="va">dl</span></span></span>
<span class="r-in"><span><span class="va">dw</span> <span class="op">&lt;-</span> <span class="fu">towide</span><span class="op">(</span><span class="va">dl</span>, idvar <span class="op">=</span> <span class="st">'subject'</span>, timevar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'date'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="tolong.html">tolong</a></span><span class="op">(</span><span class="va">dw</span>, sep <span class="op">=</span> <span class="st">'_'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sortdf.html">sortdf</a></span><span class="op">(</span><span class="va">dl2</span>, <span class="op">~</span> <span class="va">subject</span><span class="op">/</span><span class="va">time</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Variables in long form</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># This illustrates what how towide works when some variables </span></span></span>
<span class="r-in"><span><span class="co"># invariant wrt the key and others vary. Here the key is</span></span></span>
<span class="r-in"><span><span class="co"># c('country','year'). The key-variant variables are value</span></span></span>
<span class="r-in"><span><span class="co"># and rownum. The invariant variable is country.code</span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header<span class="op">=</span><span class="cn">TRUE</span>, text <span class="op">=</span> <span class="st">"</span></span></span>
<span class="r-in"><span><span class="st">country   year   variable    value country.code  rownum  </span></span></span>
<span class="r-in"><span><span class="st">Canada     2001    atemp       20   CAN           1</span></span></span>
<span class="r-in"><span><span class="st">Canada     2002    atemp       23   CAN           2</span></span></span>
<span class="r-in"><span><span class="st">US         2001    atemp       23   USA           3</span></span></span>
<span class="r-in"><span><span class="st">US         2002    atemp       23   USA           4</span></span></span>
<span class="r-in"><span><span class="st">Canada     2001    wind       120   CAN           5</span></span></span>
<span class="r-in"><span><span class="st">Canada     2002    wind       123   CAN           6</span></span></span>
<span class="r-in"><span><span class="st">US         2001    wind       123   USA           7</span></span></span>
<span class="r-in"><span><span class="st">US         2002    wind       123   USA           8</span></span></span>
<span class="r-in"><span><span class="st">Canada     2001    rain       220   CAN           9</span></span></span>
<span class="r-in"><span><span class="st">Canada     2002    rain       223   CAN           10</span></span></span>
<span class="r-in"><span><span class="st">US         2001    rain       223   USA           11</span></span></span>
<span class="r-in"><span><span class="st">US         2002    rain       223   USA           12</span></span></span>
<span class="r-in"><span><span class="st">"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">dw</span> <span class="op">&lt;-</span> <span class="fu">towide</span><span class="op">(</span><span class="va">dd</span>, idvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'country'</span>,<span class="st">'year'</span><span class="op">)</span>, timevar <span class="op">=</span> <span class="st">'variable'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># to keep only the variable name as a name</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'^value_'</span>,<span class="st">''</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dw</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># to get rid of other time varying variable</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="va">dw</span> <span class="op">&lt;-</span> <span class="va">dw</span><span class="op">[</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'_'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dw</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dw</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Georges Monette.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

